<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1æ¨™æœ¬æ¯”ç‡æ¤œå®š - é«˜æ ¡ç”Ÿã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/simple-statistics@7.8.3/dist/simple-statistics.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .hypothesis-section {
            background: #f0f8ff;
            border: 2px solid #4169E1;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .hypothesis-title {
            color: #4169E1;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .hypothesis-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #4169E1;
        }
        
        .example-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .example-title {
            color: #856404;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .input-group label {
            min-width: 150px;
            font-weight: bold;
        }
        
        .input-group input, .input-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .input-number {
            width: 120px;
        }
        
        .chart-container {
            height: 400px;
            margin: 20px 0;
        }
        
        .interpretation-section {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .interpretation-title {
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .critical-region {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .accept-region {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        
        <header>
            <h1>ğŸ“Š 1æ¨™æœ¬æ¯”ç‡æ¤œå®š</h1>
            <p>è¦³æ¸¬ã•ã‚ŒãŸæ¯”ç‡ãŒæœŸå¾…ã•ã‚Œã‚‹æ¯”ç‡ã¨æœ‰æ„ã«ç•°ãªã‚‹ã‹ã‚’æ¤œå®šã—ã¾ã™</p>
        </header>

        <main>
            <section class="instructions">
                <h2>ã“ã®æ¤œå®šã«ã¤ã„ã¦</h2>
                <p>1æ¨™æœ¬æ¯”ç‡æ¤œå®šã¯ã€è¦³æ¸¬ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®æˆåŠŸç‡ï¼ˆæ¯”ç‡ï¼‰ãŒã€æœŸå¾…ã•ã‚Œã‚‹æˆåŠŸç‡ã¨çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã‹ã‚’èª¿ã¹ã‚‹æ¤œå®šã§ã™ã€‚</p>
                <p><strong>ä¾‹ï¼š</strong> ã‚¬ãƒãƒ£ã§â˜…5ãŒå‡ºã‚‹ç¢ºç‡ãŒå…¬è¡¨å€¤ï¼ˆ3%ï¼‰ã¨åŒã˜ã‹ã©ã†ã‹ã‚’æ¤œå®šã™ã‚‹</p>
            </section>

            <section class="hypothesis-section">
                <div class="hypothesis-title">ğŸ¯ ä»®èª¬ã®è¨­å®š</div>
                <div class="hypothesis-item">
                    <strong>å¸°ç„¡ä»®èª¬ (Hâ‚€):</strong> è¦³æ¸¬ã•ã‚ŒãŸæ¯”ç‡ = æœŸå¾…ã•ã‚Œã‚‹æ¯”ç‡<br>
                    <em>ä¾‹: ã‚¬ãƒãƒ£ã®â˜…5å‡ºç¾ç‡ã¯å…¬è¡¨å€¤ã®3%ã¨åŒã˜ã§ã‚ã‚‹</em>
                </div>
                <div class="hypothesis-item">
                    <strong>å¯¾ç«‹ä»®èª¬ (Hâ‚):</strong> è¦³æ¸¬ã•ã‚ŒãŸæ¯”ç‡ â‰  æœŸå¾…ã•ã‚Œã‚‹æ¯”ç‡<br>
                    <em>ä¾‹: ã‚¬ãƒãƒ£ã®â˜…5å‡ºç¾ç‡ã¯å…¬è¡¨å€¤ã®3%ã¨ç•°ãªã‚‹</em>
                </div>
            </section>

            <section class="example-section">
                <div class="example-title">ğŸ’¡ ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹</div>
                <p>ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚ŒãŸã¨ã—ã¾ã™ï¼š</p>
                <ul>
                    <li>ç·å¼•ãå›æ•°: 1000å›</li>
                    <li>â˜…5ãŒå‡ºãŸå›æ•°: 25å›ï¼ˆå®Ÿéš›ã®ç‡: 2.5%ï¼‰</li>
                    <li>å…¬è¡¨ã•ã‚Œã¦ã„ã‚‹â˜…5ã®ç¢ºç‡: 3.0%</li>
                </ul>
                <p><strong>æ¤œå®šã®è³ªå•:</strong> ã“ã®çµæœã¯å…¬è¡¨ç¢ºç‡ã¨æœ‰æ„ã«ç•°ãªã‚‹ã‹ï¼Ÿ</p>
                <a href="gacha-simulation.html" class="btn" style="margin-top: 10px;">ğŸ² ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è©¦ã™</a>
            </section>

            <section class="test-form">
                <h2>ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                <form id="proportionTestForm">
                    <div class="input-group">
                        <label for="successCount">æˆåŠŸå›æ•° (è¦³æ¸¬å€¤):</label>
                        <input type="number" id="successCount" class="input-number" min="0" placeholder="25" required>
                        <small>ä¾‹: â˜…5ãŒå‡ºãŸå›æ•°</small>
                    </div>

                    <div class="input-group">
                        <label for="trialCount">è©¦è¡Œå›æ•° (å…¨ä½“):</label>
                        <input type="number" id="trialCount" class="input-number" min="1" placeholder="1000" required>
                        <small>ä¾‹: ã‚¬ãƒãƒ£ã‚’å¼•ã„ãŸç·å›æ•°</small>
                    </div>

                    <div class="input-group">
                        <label for="expectedRate">æœŸå¾…æ¯”ç‡ (å¸°ç„¡ä»®èª¬):</label>
                        <input type="number" id="expectedRate" class="input-number" step="0.001" min="0" max="1" placeholder="0.03" required>
                        <small>ä¾‹: 0.03 (3%)</small>
                    </div>

                    <div class="input-group">
                        <label for="significanceLevel">æœ‰æ„æ°´æº–:</label>
                        <select id="significanceLevel">
                            <option value="0.01">0.01 (1%)</option>
                            <option value="0.05" selected>0.05 (5%)</option>
                            <option value="0.10">0.10 (10%)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="testType">æ¤œå®šã®ç¨®é¡:</label>
                        <select id="testType">
                            <option value="two-tailed" selected>ä¸¡å´æ¤œå®šï¼ˆæœŸå¾…å€¤ã¨ç•°ãªã‚‹ï¼‰</option>
                            <option value="greater">ç‰‡å´æ¤œå®šï¼ˆæœŸå¾…å€¤ã‚ˆã‚Šå¤§ãã„ï¼‰</option>
                            <option value="less">ç‰‡å´æ¤œå®šï¼ˆæœŸå¾…å€¤ã‚ˆã‚Šå°ã•ã„ï¼‰</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">æ¤œå®šã‚’å®Ÿè¡Œ</button>
                </form>
            </section>

            <section id="results" class="results" style="display: none;">
                <h2>æ¤œå®šçµæœ</h2>
                <div class="results-container">
                    <div class="numeric-results">
                        <div id="resultContent" class="result-box"></div>
                    </div>
                    <div class="chart-container">
                        <h3>æ¨™æº–æ­£è¦åˆ†å¸ƒã¨æ¤œå®šçµ±è¨ˆé‡</h3>
                        <canvas id="normalDistributionChart"></canvas>
                        <div id="chartExplanation" class="chart-explanation"></div>
                    </div>
                </div>
            </section>

            <section class="interpretation-section">
                <div class="interpretation-title">ğŸ“– çµæœã®è§£é‡ˆæ–¹æ³•</div>
                <ul>
                    <li><strong>zçµ±è¨ˆé‡ï¼š</strong> è¦³æ¸¬ã•ã‚ŒãŸæ¯”ç‡ã¨æœŸå¾…æ¯”ç‡ã®å·®ã‚’æ¨™æº–èª¤å·®ã§æ¨™æº–åŒ–ã—ãŸå€¤</li>
                    <li><strong>på€¤ï¼š</strong> å¸°ç„¡ä»®èª¬ãŒæ­£ã—ã„ã¨ä»®å®šã—ãŸæ™‚ã«ã€è¦³æ¸¬ã•ã‚ŒãŸçµæœä»¥ä¸Šã®æ¥µç«¯ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ç¢ºç‡</li>
                    <li><strong>åˆ¤å®šï¼š</strong> på€¤ãŒæœ‰æ„æ°´æº–ã‚ˆã‚Šå°ã•ã„å ´åˆã€çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã¨åˆ¤æ–­</li>
                    <li><strong>å®Ÿç”¨çš„æ„å‘³ï¼š</strong> çµ±è¨ˆçš„ã«æœ‰æ„ã§ã‚‚ã€å®Ÿç”¨çš„ã«æ„å‘³ã®ã‚ã‚‹å·®ã‹ã¯åˆ¥é€”æ¤œè¨ãŒå¿…è¦</li>
                </ul>
            </section>

            <section class="explanation">
                <h2>æ¤œå®šã®ä»•çµ„ã¿</h2>
                <h3>ğŸ§® è¨ˆç®—å¼</h3>
                <ul>
                    <li><strong>è¦³æ¸¬æ¯”ç‡ï¼š</strong> pÌ‚ = æˆåŠŸå›æ•° Ã· è©¦è¡Œå›æ•°</li>
                    <li><strong>æ¨™æº–èª¤å·®ï¼š</strong> SE = âˆš(pâ‚€ Ã— (1-pâ‚€) Ã· n)</li>
                    <li><strong>zçµ±è¨ˆé‡ï¼š</strong> z = (pÌ‚ - pâ‚€) Ã· SE</li>
                    <li>ã“ã“ã§ã€pâ‚€ = æœŸå¾…æ¯”ç‡ã€n = è©¦è¡Œå›æ•°</li>
                </ul>
                
                <h3>ğŸ“‹ é©ç”¨æ¡ä»¶</h3>
                <ul>
                    <li>è©¦è¡ŒãŒç‹¬ç«‹ã—ã¦ã„ã‚‹</li>
                    <li>æˆåŠŸç¢ºç‡ãŒä¸€å®šã§ã‚ã‚‹</li>
                    <li>æ¨™æœ¬ã‚µã‚¤ã‚ºãŒååˆ†å¤§ãã„ï¼ˆnpâ‚€ â‰¥ 5 ã‹ã¤ n(1-pâ‚€) â‰¥ 5ï¼‰</li>
                </ul>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 é«˜æ ¡ç”Ÿã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</p>
        </footer>
    </div>

    <script>
        let normalChart = null;

        document.getElementById('proportionTestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            performProportionTest();
        });

        function performProportionTest() {
            try {
                // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
                const successCount = parseInt(document.getElementById('successCount').value);
                const trialCount = parseInt(document.getElementById('trialCount').value);
                const expectedRate = parseFloat(document.getElementById('expectedRate').value);
                const significanceLevel = parseFloat(document.getElementById('significanceLevel').value);
                const testType = document.getElementById('testType').value;

                // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
                if (successCount < 0 || successCount > trialCount) {
                    throw new Error('æˆåŠŸå›æ•°ã¯0ä»¥ä¸Šã€è©¦è¡Œå›æ•°ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                }
                
                if (expectedRate <= 0 || expectedRate >= 1) {
                    throw new Error('æœŸå¾…æ¯”ç‡ã¯0ã‚ˆã‚Šå¤§ãã1ã‚ˆã‚Šå°ã•ã„å€¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                }

                // é©ç”¨æ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯
                const np0 = trialCount * expectedRate;
                const n1p0 = trialCount * (1 - expectedRate);
                
                if (np0 < 5 || n1p0 < 5) {
                    console.warn('è­¦å‘Š: æ¨™æœ¬ã‚µã‚¤ã‚ºãŒå°ã•ã„ãŸã‚ã€æ­£è¦è¿‘ä¼¼ã®ç²¾åº¦ãŒä½ã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™');
                }

                // çµ±è¨ˆé‡ã®è¨ˆç®—
                const observedRate = successCount / trialCount;
                const standardError = Math.sqrt(expectedRate * (1 - expectedRate) / trialCount);
                const zStat = (observedRate - expectedRate) / standardError;

                // på€¤ã®è¨ˆç®—
                let pValue;
                if (testType === 'two-tailed') {
                    pValue = 2 * (1 - ss.cumulativeStdNormalProbability(Math.abs(zStat)));
                } else if (testType === 'greater') {
                    pValue = 1 - ss.cumulativeStdNormalProbability(zStat);
                } else { // less
                    pValue = ss.cumulativeStdNormalProbability(zStat);
                }

                // çµæœã®åˆ¤å®š
                const isSignificant = pValue < significanceLevel;

                // è‡¨ç•Œå€¤ã®è¨ˆç®—
                let criticalValues = [];
                if (testType === 'two-tailed') {
                    const criticalZ = ss.probit(1 - significanceLevel / 2);
                    criticalValues = [-criticalZ, criticalZ];
                } else if (testType === 'greater') {
                    criticalValues = [ss.probit(1 - significanceLevel)];
                } else {
                    criticalValues = [ss.probit(significanceLevel)];
                }

                const results = {
                    successCount: successCount,
                    trialCount: trialCount,
                    observedRate: observedRate,
                    expectedRate: expectedRate,
                    standardError: standardError,
                    zStat: zStat,
                    pValue: pValue,
                    significanceLevel: significanceLevel,
                    testType: testType,
                    isSignificant: isSignificant,
                    criticalValues: criticalValues,
                    rateDifference: observedRate - expectedRate
                };

                // çµæœã®è¡¨ç¤º
                displayResults(results);

                // ã‚°ãƒ©ãƒ•ã®æç”»
                drawNormalDistributionChart(results);

            } catch (error) {
                displayError(error.message);
            }
        }

        function displayResults(results) {
            const resultSection = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.className = results.isSignificant ? 'result-box success' : 'result-box';
            
            let testTypeText;
            switch(results.testType) {
                case 'two-tailed':
                    testTypeText = 'ä¸¡å´æ¤œå®š';
                    break;
                case 'greater':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼ˆè¦³æ¸¬å€¤ > æœŸå¾…å€¤ï¼‰';
                    break;
                case 'less':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼ˆè¦³æ¸¬å€¤ < æœŸå¾…å€¤ï¼‰';
                    break;
            }

            // ä¿¡é ¼åŒºé–“ã®è¨ˆç®—ï¼ˆä¸¡å´æ¤œå®šã®å ´åˆï¼‰
            let confidenceInterval = '';
            if (results.testType === 'two-tailed') {
                const confidence = 1 - results.significanceLevel;
                const marginOfError = Math.abs(results.criticalValues[1]) * results.standardError;
                const lowerBound = Math.max(0, results.observedRate - marginOfError);
                const upperBound = Math.min(1, results.observedRate + marginOfError);
                confidenceInterval = `<div class="result-item"><strong>${(confidence*100).toFixed(0)}%ä¿¡é ¼åŒºé–“:</strong> [${lowerBound.toFixed(4)}, ${upperBound.toFixed(4)}] = [${(lowerBound*100).toFixed(2)}%, ${(upperBound*100).toFixed(2)}%]</div>`;
            }

            resultContent.innerHTML = `
                <h3>åŸºæœ¬çµ±è¨ˆé‡</h3>
                <div class="result-item"><strong>æˆåŠŸå›æ•°:</strong> ${results.successCount} å›</div>
                <div class="result-item"><strong>è©¦è¡Œå›æ•°:</strong> ${results.trialCount} å›</div>
                <div class="result-item"><strong>è¦³æ¸¬æ¯”ç‡:</strong> ${results.observedRate.toFixed(4)} (${(results.observedRate*100).toFixed(2)}%)</div>
                <div class="result-item"><strong>æœŸå¾…æ¯”ç‡:</strong> ${results.expectedRate.toFixed(4)} (${(results.expectedRate*100).toFixed(2)}%)</div>
                <div class="result-item"><strong>æ¯”ç‡ã®å·®:</strong> ${results.rateDifference.toFixed(4)} (${(results.rateDifference*100).toFixed(2)}%ãƒã‚¤ãƒ³ãƒˆ)</div>
                
                <h3>æ¤œå®šçµæœ</h3>
                <div class="result-item"><strong>æ¤œå®šã®ç¨®é¡:</strong> ${testTypeText}</div>
                <div class="result-item"><strong>zçµ±è¨ˆé‡:</strong> ${results.zStat.toFixed(4)}</div>
                <div class="result-item"><strong>æ¨™æº–èª¤å·®:</strong> ${results.standardError.toFixed(6)}</div>
                <div class="result-item"><strong>på€¤:</strong> ${results.pValue.toFixed(6)}</div>
                <div class="result-item"><strong>æœ‰æ„æ°´æº–:</strong> ${results.significanceLevel}</div>
                ${confidenceInterval}
                
                <h3>åˆ¤å®š</h3>
                <div class="result-item">
                    <strong>çµè«–:</strong> 
                    ${results.isSignificant ? 
                        `på€¤ (${results.pValue.toFixed(6)}) < æœ‰æ„æ°´æº– (${results.significanceLevel}) ã®ãŸã‚ã€<strong>çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚Šã¾ã™</strong><br>
                        <em>å¸°ç„¡ä»®èª¬ã‚’æ£„å´ã—ã€è¦³æ¸¬ã•ã‚ŒãŸæ¯”ç‡ã¨æœŸå¾…æ¯”ç‡ã«ã¯æœ‰æ„ãªå·®ãŒã‚ã‚‹ã¨çµè«–ã—ã¾ã™ã€‚</em>` :
                        `på€¤ (${results.pValue.toFixed(6)}) â‰¥ æœ‰æ„æ°´æº– (${results.significanceLevel}) ã®ãŸã‚ã€<strong>çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ã¯èªã‚ã‚‰ã‚Œã¾ã›ã‚“</strong><br>
                        <em>å¸°ç„¡ä»®èª¬ã‚’æ£„å´ã§ããšã€è¦³æ¸¬ã•ã‚ŒãŸæ¯”ç‡ã¨æœŸå¾…æ¯”ç‡ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚</em>`
                    }
                </div>
            `;
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function displayError(message) {
            const resultSection = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.className = 'result-box error';
            resultContent.innerHTML = `
                <h3>ã‚¨ãƒ©ãƒ¼</h3>
                <div class="result-item">${message}</div>
                <div class="result-item">å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>
            `;
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function drawNormalDistributionChart(results) {
            try {
                const ctx = document.getElementById('normalDistributionChart').getContext('2d');
                
                // æ—¢å­˜ã®ã‚°ãƒ©ãƒ•ã‚’ç ´æ£„
                if (normalChart) {
                    normalChart.destroy();
                }

                // ãƒ‡ãƒ¼ã‚¿ç‚¹ã®ç”Ÿæˆ
                const normalPoints = [];
                const xMin = -4;
                const xMax = 4;
                const step = 0.05;
                
                for (let x = xMin; x <= xMax; x += step) {
                    const y = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
                    normalPoints.push({ x: x, y: y });
                }

                // æ¤œå®šçµ±è¨ˆé‡ã®ä½ç½®
                const testStatPoint = {
                    x: results.zStat,
                    y: (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * results.zStat * results.zStat)
                };

                // è‡¨ç•Œå€¤ã®ç‚¹
                const criticalPoints = results.criticalValues.map(val => ({
                    x: val,
                    y: (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * val * val)
                }));

                const datasets = [
                    {
                        label: 'æ¨™æº–æ­£è¦åˆ†å¸ƒ N(0,1)',
                        data: normalPoints,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        order: 3
                    },
                    {
                        label: `æ¤œå®šçµ±è¨ˆé‡ (z = ${results.zStat.toFixed(3)})`,
                        data: [testStatPoint],
                        borderColor: 'red',
                        backgroundColor: 'red',
                        pointRadius: 4,
                        pointStyle: 'circle',
                        showLine: false,
                        order: 1
                    }
                ];

                // è‡¨ç•Œå€¤ã®ç‚¹ã‚’è¿½åŠ 
                if (criticalPoints.length > 0) {
                    datasets.push({
                        label: 'è‡¨ç•Œå€¤',
                        data: criticalPoints,
                        borderColor: 'orange',
                        backgroundColor: 'orange',
                        pointRadius: 6,
                        pointStyle: 'triangle',
                        showLine: false,
                        order: 2
                    });
                }

                normalChart = new Chart(ctx, {
                    type: 'line',
                    data: { datasets: datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: 'zå€¤',
                                    font: { size: 14 }
                                },
                                min: xMin,
                                max: xMax,
                                grid: { display: true }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'ç¢ºç‡å¯†åº¦',
                                    font: { size: 14 }
                                },
                                min: 0,
                                grid: { display: true }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return `zå€¤: ${context[0].parsed.x.toFixed(3)}`;
                                    },
                                    label: function(context) {
                                        if (context.datasetIndex === 0) {
                                            return `ç¢ºç‡å¯†åº¦: ${context.parsed.y.toFixed(4)}`;
                                        } else if (context.datasetIndex === 1) {
                                            return `æ¤œå®šçµ±è¨ˆé‡: ${context.parsed.x.toFixed(3)}`;
                                        } else {
                                            return `è‡¨ç•Œå€¤: ${context.parsed.x.toFixed(3)}`;
                                        }
                                    }
                                }
                            }
                        }
                    }
                });

                // ã‚°ãƒ©ãƒ•ã®èª¬æ˜ã‚’æ›´æ–°
                updateChartExplanation(results);
                
            } catch (error) {
                console.error('ã‚°ãƒ©ãƒ•ã®æç”»ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                updateChartExplanation(results);
            }
        }

        function updateChartExplanation(results) {
            const explanation = document.getElementById('chartExplanation');
            
            let testTypeText;
            switch(results.testType) {
                case 'two-tailed':
                    testTypeText = 'ä¸¡å´æ¤œå®šï¼šä¸¡ç«¯ã®æ£„å´åŸŸ';
                    break;
                case 'greater':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼šå³å´ã®æ£„å´åŸŸ';
                    break;
                case 'less':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼šå·¦å´ã®æ£„å´åŸŸ';
                    break;
            }

            const criticalText = results.criticalValues.length > 1 ? 
                `è‡¨ç•Œå€¤: Â±${Math.abs(results.criticalValues[0]).toFixed(3)}` :
                `è‡¨ç•Œå€¤: ${results.criticalValues[0].toFixed(3)}`;

            const inCriticalRegion = results.criticalValues.some(cv => 
                results.testType === 'two-tailed' ? 
                    Math.abs(results.zStat) >= Math.abs(cv) :
                results.testType === 'greater' ?
                    results.zStat >= cv :
                    results.zStat <= cv
            );

            explanation.innerHTML = `
                <ul>
                    <li><strong>é’ã„æ›²ç·šï¼š</strong> æ¨™æº–æ­£è¦åˆ†å¸ƒ N(0,1)</li>
                    <li><strong>èµ¤ã„ç‚¹ï¼š</strong> æ¤œå®šçµ±è¨ˆé‡ z = ${results.zStat.toFixed(3)}</li>
                    <li><strong>ã‚ªãƒ¬ãƒ³ã‚¸ã®ä¸‰è§’ï¼š</strong> ${criticalText}ï¼ˆæœ‰æ„æ°´æº– ${results.significanceLevel}ï¼‰</li>
                    <li><strong>æ¤œå®šã®ç¨®é¡ï¼š</strong> ${testTypeText}</li>
                    <li><strong>på€¤ = ${results.pValue.toFixed(6)}ï¼š</strong> çµ±è¨ˆé‡ã‚ˆã‚Šæ¥µç«¯ãªå€¤ãŒå‡ºã‚‹ç¢ºç‡</li>
                    <li><strong>åˆ¤å®šï¼š</strong> ${inCriticalRegion ? 'æ£„å´åŸŸå†…ï¼ˆæœ‰æ„å·®ã‚ã‚Šï¼‰' : 'å—å®¹åŸŸå†…ï¼ˆæœ‰æ„å·®ãªã—ï¼‰'}</li>
                </ul>
            `;
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š
        function loadSampleData() {
            document.getElementById('successCount').value = "25";
            document.getElementById('trialCount').value = "1000";
            document.getElementById('expectedRate').value = "0.03";
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('proportionTestForm');
            const sampleButton = document.createElement('button');
            sampleButton.type = 'button';
            sampleButton.textContent = 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿';
            sampleButton.className = 'btn';
            sampleButton.style.marginRight = '10px';
            sampleButton.style.background = '#6c757d';
            sampleButton.onclick = loadSampleData;
            
            form.appendChild(sampleButton);
        });
    </script>
</body>
</html>
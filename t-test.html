<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹³å‡ã®å·®ã®æ¤œå®šï¼ˆtæ¤œå®šï¼‰ - é«˜æ ¡ç”Ÿã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/simple-statistics@7.8.3/dist/simple-statistics.min.js"></script>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        
        <header>
            <h1>ğŸ“ˆ å¹³å‡ã®å·®ã®æ¤œå®šï¼ˆtæ¤œå®šï¼‰</h1>
            <p>2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡å€¤ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã‹ã‚’æ¤œå®šã—ã¾ã™</p>
        </header>

        <main>
            <section class="instructions">
                <h2>ä½¿ç”¨æ–¹æ³•</h2>
                <ol>
                    <li>CODAPã§2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã™</li>
                    <li>å„ã‚°ãƒ«ãƒ¼ãƒ—ã®æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è²¼ã‚Šä»˜ã‘ã¾ã™</li>
                    <li>ãƒ‡ãƒ¼ã‚¿ã¯æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</li>
                    <li>æœ‰æ„æ°´æº–ã‚’é¸æŠã—ã¾ã™ï¼ˆé€šå¸¸ã¯0.05ï¼‰</li>
                    <li>ã€Œæ¤œå®šã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™</li>
                </ol>
            </section>

            <section class="test-form">
                <h2>ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                <form id="tTestForm">
                    <div class="form-group">
                        <label for="group1Data">ã‚°ãƒ«ãƒ¼ãƒ—1ã®ãƒ‡ãƒ¼ã‚¿</label>
                        <textarea id="group1Data" placeholder="ä¾‹: 12.3&#10;14.5&#10;13.1&#10;15.2&#10;ã¾ãŸã¯&#10;12.3, 14.5, 13.1, 15.2" required></textarea>
                        <small>æ•°å€¤ã‚’æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="group2Data">ã‚°ãƒ«ãƒ¼ãƒ—2ã®ãƒ‡ãƒ¼ã‚¿</label>
                        <textarea id="group2Data" placeholder="ä¾‹: 10.1&#10;11.8&#10;12.3&#10;11.5&#10;ã¾ãŸã¯&#10;10.1, 11.8, 12.3, 11.5" required></textarea>
                        <small>æ•°å€¤ã‚’æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="significanceLevel">æœ‰æ„æ°´æº–</label>
                        <select id="significanceLevel">
                            <option value="0.01">0.01 (1%)</option>
                            <option value="0.05" selected>0.05 (5%)</option>
                            <option value="0.10">0.10 (10%)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="testType">æ¤œå®šã®ç¨®é¡</label>
                        <select id="testType">
                            <option value="two-tailed" selected>ä¸¡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 â‰  ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰</option>
                            <option value="greater">ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 > ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰</option>
                            <option value="less">ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 < ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">æ¤œå®šã‚’å®Ÿè¡Œ</button>
                </form>
            </section>

            <section id="results" class="results" style="display: none;">
                <h2>æ¤œå®šçµæœ</h2>
                <div id="resultContent" class="result-box"></div>
            </section>

            <section class="explanation">
                <h2>çµæœã®è§£é‡ˆ</h2>
                <ul>
                    <li><strong>tçµ±è¨ˆé‡ï¼š</strong> 2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡ã®å·®ã‚’æ¨™æº–èª¤å·®ã§å‰²ã£ãŸå€¤</li>
                    <li><strong>è‡ªç”±åº¦ï¼š</strong> ãƒ‡ãƒ¼ã‚¿ã®æ•°ã‹ã‚‰åˆ¶ç´„ã‚’å¼•ã„ãŸå€¤</li>
                    <li><strong>på€¤ï¼š</strong> å¸°ç„¡ä»®èª¬ãŒæ­£ã—ã„ã¨ä»®å®šã—ãŸæ™‚ã«ã€è¦³æ¸¬ã•ã‚ŒãŸçµæœä»¥ä¸Šã®æ¥µç«¯ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ç¢ºç‡</li>
                    <li><strong>åˆ¤å®šï¼š</strong> på€¤ãŒæœ‰æ„æ°´æº–ã‚ˆã‚Šå°ã•ã„å ´åˆã€çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã¨åˆ¤æ–­</li>
                </ul>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 é«˜æ ¡ç”Ÿã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</p>
        </footer>
    </div>

    <script>
        document.getElementById('tTestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            performTTest();
        });

        function parseData(dataString) {
            // æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’æ•°å€¤é…åˆ—ã«å¤‰æ›
            const data = dataString.trim()
                .split(/[\n,]+/)
                .map(x => x.trim())
                .filter(x => x !== '')
                .map(x => parseFloat(x))
                .filter(x => !isNaN(x));
            
            return data;
        }

        function performTTest() {
            try {
                // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è§£æ
                const group1String = document.getElementById('group1Data').value;
                const group2String = document.getElementById('group2Data').value;
                const significanceLevel = parseFloat(document.getElementById('significanceLevel').value);
                const testType = document.getElementById('testType').value;

                const group1 = parseData(group1String);
                const group2 = parseData(group2String);

                // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
                if (group1.length < 2 || group2.length < 2) {
                    throw new Error('å„ã‚°ãƒ«ãƒ¼ãƒ—ã«æœ€ä½2ã¤ã®ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™');
                }

                // åŸºæœ¬çµ±è¨ˆé‡ã®è¨ˆç®—
                const mean1 = ss.mean(group1);
                const mean2 = ss.mean(group2);
                const sd1 = ss.standardDeviation(group1);
                const sd2 = ss.standardDeviation(group2);
                const n1 = group1.length;
                const n2 = group2.length;

                // tæ¤œå®šã®è¨ˆç®—
                const result = ss.tTestTwoSample(group1, group2, 0);
                const tStat = result;
                
                // è‡ªç”±åº¦ã®è¨ˆç®—ï¼ˆã‚¦ã‚§ãƒ«ãƒã®tæ¤œå®šï¼‰
                const var1 = ss.variance(group1);
                const var2 = ss.variance(group2);
                const df = Math.pow(var1/n1 + var2/n2, 2) / 
                          (Math.pow(var1/n1, 2)/(n1-1) + Math.pow(var2/n2, 2)/(n2-1));

                // på€¤ã®è¨ˆç®—ï¼ˆè¿‘ä¼¼ï¼‰
                let pValue;
                if (testType === 'two-tailed') {
                    pValue = 2 * (1 - ss.cumulativeStdNormalProbability(Math.abs(tStat)));
                } else if (testType === 'greater') {
                    pValue = 1 - ss.cumulativeStdNormalProbability(tStat);
                } else { // less
                    pValue = ss.cumulativeStdNormalProbability(tStat);
                }

                // çµæœã®åˆ¤å®š
                const isSignificant = pValue < significanceLevel;

                // çµæœã®è¡¨ç¤º
                displayResults({
                    group1: { mean: mean1, sd: sd1, n: n1 },
                    group2: { mean: mean2, sd: sd2, n: n2 },
                    tStat: tStat,
                    df: df,
                    pValue: pValue,
                    significanceLevel: significanceLevel,
                    testType: testType,
                    isSignificant: isSignificant,
                    meanDifference: mean1 - mean2
                });

            } catch (error) {
                displayError(error.message);
            }
        }

        function displayResults(results) {
            const resultSection = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.className = results.isSignificant ? 'result-box success' : 'result-box';
            
            let testTypeText;
            switch(results.testType) {
                case 'two-tailed':
                    testTypeText = 'ä¸¡å´æ¤œå®š';
                    break;
                case 'greater':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 > ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰';
                    break;
                case 'less':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 < ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰';
                    break;
            }

            resultContent.innerHTML = `
                <h3>åŸºæœ¬çµ±è¨ˆé‡</h3>
                <div class="result-item"><strong>ã‚°ãƒ«ãƒ¼ãƒ—1:</strong> å¹³å‡ = ${results.group1.mean.toFixed(3)}, æ¨™æº–åå·® = ${results.group1.sd.toFixed(3)}, n = ${results.group1.n}</div>
                <div class="result-item"><strong>ã‚°ãƒ«ãƒ¼ãƒ—2:</strong> å¹³å‡ = ${results.group2.mean.toFixed(3)}, æ¨™æº–åå·® = ${results.group2.sd.toFixed(3)}, n = ${results.group2.n}</div>
                <div class="result-item"><strong>å¹³å‡ã®å·®:</strong> ${results.meanDifference.toFixed(3)}</div>
                
                <h3>æ¤œå®šçµæœ</h3>
                <div class="result-item"><strong>æ¤œå®šã®ç¨®é¡:</strong> ${testTypeText}</div>
                <div class="result-item"><strong>tçµ±è¨ˆé‡:</strong> ${results.tStat.toFixed(4)}</div>
                <div class="result-item"><strong>è‡ªç”±åº¦:</strong> ${results.df.toFixed(1)}</div>
                <div class="result-item"><strong>på€¤:</strong> ${results.pValue.toFixed(6)}</div>
                <div class="result-item"><strong>æœ‰æ„æ°´æº–:</strong> ${results.significanceLevel}</div>
                
                <h3>åˆ¤å®š</h3>
                <div class="result-item">
                    <strong>çµè«–:</strong> 
                    ${results.isSignificant ? 
                        `på€¤ (${results.pValue.toFixed(6)}) < æœ‰æ„æ°´æº– (${results.significanceLevel}) ã®ãŸã‚ã€<strong>çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚Šã¾ã™</strong>` :
                        `på€¤ (${results.pValue.toFixed(6)}) â‰¥ æœ‰æ„æ°´æº– (${results.significanceLevel}) ã®ãŸã‚ã€<strong>çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ã¯èªã‚ã‚‰ã‚Œã¾ã›ã‚“</strong>`
                    }
                </div>
            `;
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function displayError(message) {
            const resultSection = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.className = 'result-box error';
            resultContent.innerHTML = `
                <h3>ã‚¨ãƒ©ãƒ¼</h3>
                <div class="result-item">${message}</div>
                <div class="result-item">ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>
            `;
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®è¨­å®šï¼ˆé–‹ç™ºç”¨ï¼‰
        function loadSampleData() {
            document.getElementById('group1Data').value = "12.3\n14.5\n13.1\n15.2\n11.8\n13.7\n14.1";
            document.getElementById('group2Data').value = "10.1\n11.8\n12.3\n11.5\n9.8\n10.9\n11.2";
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼ˆé–‹ç™ºç”¨ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('tTestForm');
            const sampleButton = document.createElement('button');
            sampleButton.type = 'button';
            sampleButton.textContent = 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿';
            sampleButton.className = 'btn';
            sampleButton.style.marginRight = '10px';
            sampleButton.style.background = '#6c757d';
            sampleButton.onclick = loadSampleData;
            
            form.appendChild(sampleButton);
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹³å‡ã®å·®ã®æ¤œå®šï¼ˆtæ¤œå®šï¼‰ - é«˜æ ¡ç”Ÿã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/simple-statistics@7.8.3/dist/simple-statistics.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        
        <header>
            <h1>ğŸ“ˆ å¹³å‡ã®å·®ã®æ¤œå®šï¼ˆtæ¤œå®šï¼‰</h1>
            <p>2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡å€¤ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã‹ã‚’æ¤œå®šã—ã¾ã™</p>
        </header>

        <main>
            <section class="instructions">
                <h2>ä½¿ç”¨æ–¹æ³•</h2>
                <ol>
                    <li>CODAPã§2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã™</li>
                    <li>å„ã‚°ãƒ«ãƒ¼ãƒ—ã®æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è²¼ã‚Šä»˜ã‘ã¾ã™</li>
                    <li>ãƒ‡ãƒ¼ã‚¿ã¯æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</li>
                    <li>æœ‰æ„æ°´æº–ã‚’é¸æŠã—ã¾ã™ï¼ˆé€šå¸¸ã¯0.05ï¼‰</li>
                    <li>ã€Œæ¤œå®šã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™</li>
                </ol>
            </section>

            <section class="test-form">
                <h2>ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                <form id="tTestForm">
                    <div class="form-group">
                        <label for="group1Data">ã‚°ãƒ«ãƒ¼ãƒ—1ã®ãƒ‡ãƒ¼ã‚¿</label>
                        <textarea id="group1Data" placeholder="ä¾‹: 12.3&#10;14.5&#10;13.1&#10;15.2&#10;ã¾ãŸã¯&#10;12.3, 14.5, 13.1, 15.2" required></textarea>
                        <small>æ•°å€¤ã‚’æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="group2Data">ã‚°ãƒ«ãƒ¼ãƒ—2ã®ãƒ‡ãƒ¼ã‚¿</label>
                        <textarea id="group2Data" placeholder="ä¾‹: 10.1&#10;11.8&#10;12.3&#10;11.5&#10;ã¾ãŸã¯&#10;10.1, 11.8, 12.3, 11.5" required></textarea>
                        <small>æ•°å€¤ã‚’æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="significanceLevel">æœ‰æ„æ°´æº–</label>
                        <select id="significanceLevel">
                            <option value="0.01">0.01 (1%)</option>
                            <option value="0.05" selected>0.05 (5%)</option>
                            <option value="0.10">0.10 (10%)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="testType">æ¤œå®šã®ç¨®é¡</label>
                        <select id="testType">
                            <option value="two-tailed" selected>ä¸¡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 â‰  ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰</option>
                            <option value="greater">ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 > ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰</option>
                            <option value="less">ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 < ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">æ¤œå®šã‚’å®Ÿè¡Œ</button>
                </form>
            </section>

            <section id="results" class="results" style="display: none;">
                <h2>æ¤œå®šçµæœ</h2>
                <div class="results-container">
                    <div class="numeric-results">
                        <div id="resultContent" class="result-box"></div>
                    </div>
                    <div class="chart-container">
                        <h3>tåˆ†å¸ƒã¨æ¤œå®šçµ±è¨ˆé‡</h3>
                        <canvas id="tDistributionChart"></canvas>
                        <div id="chartExplanation" class="chart-explanation"></div>
                    </div>
                </div>
            </section>

            <section class="explanation">
                <h2>çµæœã®è§£é‡ˆ</h2>
                <ul>
                    <li><strong>tçµ±è¨ˆé‡ï¼š</strong> 2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡ã®å·®ã‚’æ¨™æº–èª¤å·®ã§å‰²ã£ãŸå€¤</li>
                    <li><strong>è‡ªç”±åº¦ï¼š</strong> ãƒ‡ãƒ¼ã‚¿ã®æ•°ã‹ã‚‰åˆ¶ç´„ã‚’å¼•ã„ãŸå€¤</li>
                    <li><strong>på€¤ï¼š</strong> å¸°ç„¡ä»®èª¬ãŒæ­£ã—ã„ã¨ä»®å®šã—ãŸæ™‚ã«ã€è¦³æ¸¬ã•ã‚ŒãŸçµæœä»¥ä¸Šã®æ¥µç«¯ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ç¢ºç‡</li>
                    <li><strong>åˆ¤å®šï¼š</strong> på€¤ãŒæœ‰æ„æ°´æº–ã‚ˆã‚Šå°ã•ã„å ´åˆã€çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚‹ã¨åˆ¤æ–­</li>
                </ul>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 é«˜æ ¡ç”Ÿã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹</p>
        </footer>
    </div>

    <script>
        // ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã‚ãªã„ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…
        let tDistChart = null; // ã‚°ãƒ©ãƒ•ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¿å­˜
        
        document.getElementById('tTestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            performTTest();
        });

        function parseData(dataString) {
            // æ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’æ•°å€¤é…åˆ—ã«å¤‰æ›
            const data = dataString.trim()
                .split(/[\n,]+/)
                .map(x => x.trim())
                .filter(x => x !== '')
                .map(x => parseFloat(x))
                .filter(x => !isNaN(x));
            
            return data;
        }

        function performTTest() {
            try {
                // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è§£æ
                const group1String = document.getElementById('group1Data').value;
                const group2String = document.getElementById('group2Data').value;
                const significanceLevel = parseFloat(document.getElementById('significanceLevel').value);
                const testType = document.getElementById('testType').value;

                const group1 = parseData(group1String);
                const group2 = parseData(group2String);

                // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
                if (group1.length < 2 || group2.length < 2) {
                    throw new Error('å„ã‚°ãƒ«ãƒ¼ãƒ—ã«æœ€ä½2ã¤ã®ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™');
                }

                // åŸºæœ¬çµ±è¨ˆé‡ã®è¨ˆç®—
                const mean1 = ss.mean(group1);
                const mean2 = ss.mean(group2);
                const sd1 = ss.standardDeviation(group1);
                const sd2 = ss.standardDeviation(group2);
                const n1 = group1.length;
                const n2 = group2.length;

                // tæ¤œå®šã®è¨ˆç®—
                const result = ss.tTestTwoSample(group1, group2, 0);
                const tStat = result;
                
                // è‡ªç”±åº¦ã®è¨ˆç®—ï¼ˆã‚¦ã‚§ãƒ«ãƒã®tæ¤œå®šï¼‰
                const var1 = ss.variance(group1);
                const var2 = ss.variance(group2);
                const df = Math.pow(var1/n1 + var2/n2, 2) / 
                          (Math.pow(var1/n1, 2)/(n1-1) + Math.pow(var2/n2, 2)/(n2-1));

                // på€¤ã®è¨ˆç®—ï¼ˆè¿‘ä¼¼ï¼‰
                let pValue;
                if (testType === 'two-tailed') {
                    pValue = 2 * (1 - ss.cumulativeStdNormalProbability(Math.abs(tStat)));
                } else if (testType === 'greater') {
                    pValue = 1 - ss.cumulativeStdNormalProbability(tStat);
                } else { // less
                    pValue = ss.cumulativeStdNormalProbability(tStat);
                }

                // çµæœã®åˆ¤å®š
                const isSignificant = pValue < significanceLevel;

                const results = {
                    group1: { mean: mean1, sd: sd1, n: n1 },
                    group2: { mean: mean2, sd: sd2, n: n2 },
                    tStat: tStat,
                    df: df,
                    pValue: pValue,
                    significanceLevel: significanceLevel,
                    testType: testType,
                    isSignificant: isSignificant,
                    meanDifference: mean1 - mean2
                };

                // çµæœã®è¡¨ç¤º
                displayResults(results);

                // ã‚°ãƒ©ãƒ•ã®æç”»
                drawTDistributionChart(results.tStat, results.df, results.significanceLevel, results.testType, results.pValue);

            } catch (error) {
                displayError(error.message);
            }
        }

        function displayResults(results) {
            const resultSection = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.className = results.isSignificant ? 'result-box success' : 'result-box';
            
            let testTypeText;
            switch(results.testType) {
                case 'two-tailed':
                    testTypeText = 'ä¸¡å´æ¤œå®š';
                    break;
                case 'greater':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 > ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰';
                    break;
                case 'less':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—1 < ã‚°ãƒ«ãƒ¼ãƒ—2ï¼‰';
                    break;
            }

            resultContent.innerHTML = `
                <h3>åŸºæœ¬çµ±è¨ˆé‡</h3>
                <div class="result-item"><strong>ã‚°ãƒ«ãƒ¼ãƒ—1:</strong> å¹³å‡ = ${results.group1.mean.toFixed(3)}, æ¨™æº–åå·® = ${results.group1.sd.toFixed(3)}, n = ${results.group1.n}</div>
                <div class="result-item"><strong>ã‚°ãƒ«ãƒ¼ãƒ—2:</strong> å¹³å‡ = ${results.group2.mean.toFixed(3)}, æ¨™æº–åå·® = ${results.group2.sd.toFixed(3)}, n = ${results.group2.n}</div>
                <div class="result-item"><strong>å¹³å‡ã®å·®:</strong> ${results.meanDifference.toFixed(3)}</div>
                
                <h3>æ¤œå®šçµæœ</h3>
                <div class="result-item"><strong>æ¤œå®šã®ç¨®é¡:</strong> ${testTypeText}</div>
                <div class="result-item"><strong>tçµ±è¨ˆé‡:</strong> ${results.tStat.toFixed(4)}</div>
                <div class="result-item"><strong>è‡ªç”±åº¦:</strong> ${results.df.toFixed(1)}</div>
                <div class="result-item"><strong>på€¤:</strong> ${results.pValue.toFixed(6)}</div>
                <div class="result-item"><strong>æœ‰æ„æ°´æº–:</strong> ${results.significanceLevel}</div>
                
                <h3>åˆ¤å®š</h3>
                <div class="result-item">
                    <strong>çµè«–:</strong> 
                    ${results.isSignificant ? 
                        `på€¤ (${results.pValue.toFixed(6)}) < æœ‰æ„æ°´æº– (${results.significanceLevel}) ã®ãŸã‚ã€<strong>çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚Šã¾ã™</strong>` :
                        `på€¤ (${results.pValue.toFixed(6)}) â‰¥ æœ‰æ„æ°´æº– (${results.significanceLevel}) ã®ãŸã‚ã€<strong>çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ã¯èªã‚ã‚‰ã‚Œã¾ã›ã‚“</strong>`
                    }
                </div>
            `;
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function displayError(message) {
            const resultSection = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.className = 'result-box error';
            resultContent.innerHTML = `
                <h3>ã‚¨ãƒ©ãƒ¼</h3>
                <div class="result-item">${message}</div>
                <div class="result-item">ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>
            `;
            
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // tåˆ†å¸ƒã®ç¢ºç‡å¯†åº¦é–¢æ•°ï¼ˆæ”¹è‰¯ç‰ˆãƒ»å¤§ããªè‡ªç”±åº¦ã«å¯¾å¿œï¼‰
        function tDistributionPDF(x, df) {
            // è‡ªç”±åº¦ãŒå¤§ãã„å ´åˆã¯æ¨™æº–æ­£è¦åˆ†å¸ƒã§è¿‘ä¼¼
            if (df > 100) {
                return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
            }
            
            try {
                const logGamma1 = logGamma((df + 1) / 2);
                const logGamma2 = logGamma(df / 2);
                const logCoefficient = logGamma1 - 0.5 * Math.log(df * Math.PI) - logGamma2;
                const logDensity = logCoefficient - ((df + 1) / 2) * Math.log(1 + (x * x) / df);
                
                const result = Math.exp(logDensity);
                return isNaN(result) || !isFinite(result) ? 0 : result;
            } catch (error) {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šæ¨™æº–æ­£è¦åˆ†å¸ƒ
                return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
            }
        }

        // ã‚¬ãƒ³ãƒé–¢æ•°ã®å¯¾æ•°ï¼ˆæ”¹è‰¯ç‰ˆãƒ»æ•°å€¤å®‰å®šæ€§å‘ä¸Šï¼‰
        function logGamma(z) {
            if (z <= 0) return Infinity;
            
            // å¤§ããªå€¤ã«å¯¾ã—ã¦ã¯ã‚¹ã‚¿ãƒ¼ãƒªãƒ³ã‚°è¿‘ä¼¼ã‚’ä½¿ç”¨
            if (z > 100) {
                return (z - 0.5) * Math.log(z) - z + 0.5 * Math.log(2 * Math.PI);
            }
            
            if (z < 0.5) {
                const result = Math.log(Math.PI) - Math.log(Math.sin(Math.PI * z)) - logGamma(1 - z);
                return isFinite(result) ? result : 0;
            }
            
            z -= 1;
            let x = 0.99999999999980993;
            const coefficients = [
                676.5203681218851, -1259.1392167224028, 771.32342877765313,
                -176.61502916214059, 12.507343278686905, -0.13857109526572012,
                9.9843695780195716e-6, 1.5056327351493116e-7
            ];
            
            try {
                for (let i = 0; i < coefficients.length; i++) {
                    x += coefficients[i] / (z + i + 1);
                }
                const t = z + coefficients.length - 0.5;
                const result = 0.5 * Math.log(2 * Math.PI) + (z + 0.5) * Math.log(t) - t + Math.log(x);
                return isFinite(result) ? result : 0;
            } catch (error) {
                return 0;
            }
        }

        // tåˆ†å¸ƒã®ã‚°ãƒ©ãƒ•ã‚’æç”»ï¼ˆæ”¹è‰¯ç‰ˆãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ï¼‰
        function drawTDistributionChart(tStat, df, significanceLevel, testType, pValue) {
            try {
                const ctx = document.getElementById('tDistributionChart').getContext('2d');
                
                // æ—¢å­˜ã®ã‚°ãƒ©ãƒ•ã‚’ç ´æ£„
                if (tDistChart) {
                    tDistChart.destroy();
                }

                // ãƒ‡ãƒ¼ã‚¿ç‚¹ã®ç”Ÿæˆ
                const tDistPoints = [];
                const xMin = -4;
                const xMax = 4;
                const step = 0.05;
                
                for (let x = xMin; x <= xMax; x += step) {
                    const y = tDistributionPDF(x, df);
                    if (isFinite(y) && y >= 0) {
                        tDistPoints.push({
                            x: x,
                            y: y
                        });
                    }
                }
                
                // ãƒ‡ãƒ¼ã‚¿ç‚¹ãŒä¸ååˆ†ãªå ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                if (tDistPoints.length < 10) {
                    console.error('ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                    updateChartExplanation(tStat, df, testType, pValue, significanceLevel, []);
                    return;
                }

            // æ¤œå®šçµ±è¨ˆé‡ã®ä½ç½®ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
            const testStatPoint = {
                x: tStat,
                y: tDistributionPDF(tStat, df)
            };

            // è‡¨ç•Œå€¤ã®è¨ˆç®—ï¼ˆè¿‘ä¼¼ï¼‰
            let criticalValues = [];
            if (testType === 'two-tailed') {
                // ä¸¡å´æ¤œå®šã®è‡¨ç•Œå€¤ï¼ˆç°¡æ˜“è¿‘ä¼¼ï¼‰
                const criticalValue = significanceLevel === 0.05 ? 1.96 : 
                                    significanceLevel === 0.01 ? 2.58 : 1.645;
                criticalValues = [-criticalValue, criticalValue];
            } else if (testType === 'greater') {
                const criticalValue = significanceLevel === 0.05 ? 1.645 : 
                                    significanceLevel === 0.01 ? 2.33 : 1.28;
                criticalValues = [criticalValue];
            } else {
                const criticalValue = significanceLevel === 0.05 ? -1.645 : 
                                    significanceLevel === 0.01 ? -2.33 : -1.28;
                criticalValues = [criticalValue];
            }

            // è‡¨ç•Œå€¤ã®ç‚¹ã‚’ä½œæˆ
            const criticalPoints = criticalValues.map(val => ({
                x: val,
                y: tDistributionPDF(val, df)
            }));

            const datasets = [
                {
                    label: `tåˆ†å¸ƒ (è‡ªç”±åº¦: ${df.toFixed(1)})`,
                    data: tDistPoints,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    order: 3
                },
                {
                    label: `æ¤œå®šçµ±è¨ˆé‡ (t = ${tStat.toFixed(3)})`,
                    data: [testStatPoint],
                    borderColor: 'red',
                    backgroundColor: 'red',
                    pointRadius: 4,
                    pointStyle: 'circle',
                    showLine: false,
                    order: 1
                }
            ];

            // è‡¨ç•Œå€¤ã®ç‚¹ã‚’è¿½åŠ 
            if (criticalPoints.length > 0) {
                datasets.push({
                    label: 'è‡¨ç•Œå€¤',
                    data: criticalPoints,
                    borderColor: 'orange',
                    backgroundColor: 'orange',
                    pointRadius: 6,
                    pointStyle: 'triangle',
                    showLine: false,
                    order: 2
                });
            }

            tDistChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'tå€¤',
                                font: {
                                    size: 14
                                }
                            },
                            min: xMin,
                            max: xMax,
                            grid: {
                                display: true
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç¢ºç‡å¯†åº¦',
                                font: {
                                    size: 14
                                }
                            },
                            min: 0,
                            grid: {
                                display: true
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `tå€¤: ${context[0].parsed.x.toFixed(3)}`;
                                },
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `ç¢ºç‡å¯†åº¦: ${context.parsed.y.toFixed(4)}`;
                                    } else if (context.datasetIndex === 1) {
                                        return `æ¤œå®šçµ±è¨ˆé‡: ${context.parsed.x.toFixed(3)}`;
                                    } else {
                                        return `è‡¨ç•Œå€¤: ${context.parsed.x.toFixed(3)}`;
                                    }
                                }
                            }
                        }
                    }
                }
            });

                // ã‚°ãƒ©ãƒ•ã®èª¬æ˜ã‚’æ›´æ–°
                updateChartExplanation(tStat, df, testType, pValue, significanceLevel, criticalValues);
                
            } catch (error) {
                console.error('ã‚°ãƒ©ãƒ•ã®æç”»ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚èª¬æ˜ã¯è¡¨ç¤º
                updateChartExplanation(tStat, df, testType, pValue, significanceLevel, []);
            }
        }

        // ã‚°ãƒ©ãƒ•ã®èª¬æ˜ã‚’æ›´æ–°
        function updateChartExplanation(tStat, df, testType, pValue, significanceLevel, criticalValues) {
            const explanation = document.getElementById('chartExplanation');
            
            let testTypeText;
            switch(testType) {
                case 'two-tailed':
                    testTypeText = 'ä¸¡å´æ¤œå®šï¼šä¸¡ç«¯ã®æ£„å´åŸŸ';
                    break;
                case 'greater':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼šå³å´ã®æ£„å´åŸŸ';
                    break;
                case 'less':
                    testTypeText = 'ç‰‡å´æ¤œå®šï¼šå·¦å´ã®æ£„å´åŸŸ';
                    break;
            }

            const criticalText = criticalValues.length > 1 ? 
                `è‡¨ç•Œå€¤: Â±${Math.abs(criticalValues[0]).toFixed(3)}` :
                `è‡¨ç•Œå€¤: ${criticalValues[0].toFixed(3)}`;

            explanation.innerHTML = `
                <ul>
                    <li><strong>é’ã„æ›²ç·šï¼š</strong> tåˆ†å¸ƒï¼ˆè‡ªç”±åº¦ ${df.toFixed(1)}ï¼‰</li>
                    <li><strong>èµ¤ã„ç‚¹ï¼š</strong> æ¤œå®šçµ±è¨ˆé‡ t = ${tStat.toFixed(3)}</li>
                    <li><strong>ã‚ªãƒ¬ãƒ³ã‚¸ã®ä¸‰è§’ï¼š</strong> ${criticalText}ï¼ˆæœ‰æ„æ°´æº– ${significanceLevel}ï¼‰</li>
                    <li><strong>æ¤œå®šã®ç¨®é¡ï¼š</strong> ${testTypeText}</li>
                    <li><strong>på€¤ = ${pValue.toFixed(6)}ï¼š</strong> çµ±è¨ˆé‡ã‚ˆã‚Šæ¥µç«¯ãªå€¤ãŒå‡ºã‚‹ç¢ºç‡</li>
                    <li><strong>åˆ¤å®šï¼š</strong> ${Math.abs(tStat) > Math.abs(criticalValues[0]) ? 'æ£„å´åŸŸå†…ï¼ˆæœ‰æ„å·®ã‚ã‚Šï¼‰' : 'å—å®¹åŸŸå†…ï¼ˆæœ‰æ„å·®ãªã—ï¼‰'}</li>
                </ul>
            `;
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®è¨­å®šï¼ˆé–‹ç™ºç”¨ï¼‰
        function loadSampleData() {
            document.getElementById('group1Data').value = "85\n87\n92\n78\n90\n88\n85\n89";
            document.getElementById('group2Data').value = "82\n84\n86\n80\n83\n85\n81\n84";
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼ˆé–‹ç™ºç”¨ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('tTestForm');
            const sampleButton = document.createElement('button');
            sampleButton.type = 'button';
            sampleButton.textContent = 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿';
            sampleButton.className = 'btn';
            sampleButton.style.marginRight = '10px';
            sampleButton.style.background = '#6c757d';
            sampleButton.onclick = loadSampleData;
            
            form.appendChild(sampleButton);
        });
    </script>
</body>
</html>
